<h1>Respond to <%= @question_set.title %> as <%= @member.full_name %> (<%= @member.membership_code %>)</h1>

<%= form_for @question_set, :url => {:action => "batch_create", params: {responder: @member.entity_id, subject: @member.entity_id}}, method: "post" do |f| %>
  <%= f.fields_for :questions do |question| %>
    <h3><%= question.object.question %></h3>
    <%= f.fields_for :question_response do |response| %>
      <%# If there's a string here, then it's an array of acceptable answers %>
      <% if question.object.response %>
        <% JSON.parse(question.object.response).each_with_index do |option, idx| %>
          <%= response.radio_button "#{question.object.id}", idx %>
          <%= response.label "#{question.object.id}_#{idx}", option %>
        <% end %>
      <% else %>
        <%= response.text_area "#{question.object.id}", cols: "80", rows: "5" %>
      <% end %>
    <% end %>
  <% end %>
  <%= f.submit %>
<% end %>
